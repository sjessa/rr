---
title: "01 - Analysis 1"
author: "Selin Jessa"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    theme: flatly
    css: include/style.css
    toc: yes
    toc_depth: 4
    number_sections: true
    df_print: paged
    keep_md: yes
---

<!-- FRONT MATTER -->

<!-- Load custom CSS/JS for code folding -->
<link rel="stylesheet" type="text/css" href="include/hideOutput.css">
<script src="include/hideOutput.js"></script>

***

# Configuration

Configuration of project directory & analysis outputs:

<details><summary>Show full config</summary>

```{r path_from_here, echo = FALSE}

# The here() function always returns a full path from the root directory
# This function returns a path from the project root
path_from_here <- function(path) {
    
    paste0(basename(here::here()), # Project root directory
           strsplit(path, basename(here::here()))[[1]][2]) # Chosen path relative to project root
    
}

```

```{r config, warning = FALSE}

library(here)

# Set up outputs

# ...determines the name of the cache folder
project_id <- "rr"

# ...determines name of the subfolder of `outputs` and `figures`
doc_id     <- "01"

# ...specify where to save outputs
out        <- here("output", doc_id); dir.create(out, recursive = TRUE)
figout     <- here("figures", doc_id, "/")
cache      <- paste0("~/tmp/", project_id, "/", doc_id, "/")

```

</details>

The root directory of this project is:

```{r here, echo = FALSE, cache = FALSE}

message(here())

```

Outputs and figures will be saved at these paths, relative to project root:

```{r print_out_paths, echo = FALSE, cache = FALSE}

message(path_from_here(out))
message(path_from_here(figout))

```

```{r setup, include = FALSE}

# Code to print the location of output / figures, relative to the root
# Usage: set "echo_fig = TRUE" or "echo_out = TRUE" in knitr chunk options
# via https://gist.github.com/Thell/5827832
knitr::knit_hooks$set( echo_fig = function(before, options, envir) {
    if ( before ) {
        # Do nothing
    } else sprintf('<br><span style="color:#0d00ff">~[figure @ *%s*]~</span>',
                   paste0(
                       path_from_here(figout),
                       options$label, "...") )
})

knitr::knit_hooks$set( echo_out = function(before, options, envir) {
    if ( before ) {
        # Do nothing
    } else sprintf('<br><span style="color:#0d00ff">~[output @ *%s*]~</span>',
                   paste0(path_from_here(out),
                          "/",
                          options$label) )
})

# Set knitr options
knitr::opts_chunk$set(message = TRUE,
                      warning = FALSE,
                      error = FALSE,
                      cache = TRUE,
                      cache.path = cache,
                      fig.path = figout,
                      fig.keep = "all",
                      dev = c("png", "pdf"),
                      cache.lazy = FALSE)

options(knitr.table.format = "html") 

# Expand the width for more plotting area
knitr::opts_knit$set(width = 1600)

```

<!-- END OF FRONT MATTER -->

***

# Overview

This is an example of the first analysis in a project.

# Libraries

```{r libs, warning = FALSE, message = FALSE, echo = TRUE, cache = FALSE}

library(ggplot2)
library(tidyverse)

```

```{asis, echo = TRUE}

Here is a note to self. This markdown code is contained in a check, 
with visibility controlled by the `echo` chunk option.

Change echo to TRUE or FALSE to display/hide this chunk.

```



# Analysis

## Part 1

This part of the analysis generates a figure; we can use the chunk option
`echo_fig = TRUE` to print its output path.

```{r pressure, echo_fig = TRUE, cache = FALSE}

mtcars %>% 
    ggplot(aes(x = mpg, y = cyl)) +
    geom_point() +
    theme_bw()

```

## Part 2

This part of the analysis saves the `mtcars` dataset from R as a TSV.
By matching the chunk name to the output file name, we can then use
the `echo_out = TRUE` chunk option to show the path to the fil.

```{r mtcars.tsv, echo_out = TRUE}

head(mtcars)

write.table(mtcars, file.path(out, "mtcars.tsv"))

```



***

# Reproducibility


This document was last rendered on:

```{r time, echo = FALSE, cache = FALSE}

message(Sys.time())

```

Session info:
<details>

```{r sinfo, cache = FALSE, echo = FALSE}

if ("devtools" %in% installed.packages()) {
    devtools::session_info()
} else sessionInfo()

```

</details>

<!-- FOOTER -->

***

<center>
```{r logo, echo = FALSE, out.width = '20%', out.height = '20%'}

knitr::include_graphics(here::here("include", "kleinman_lab_logo.png"))

```
</center>

<!-- Add icon library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<p style="text-align: center;">
A project of the Kleinman Lab at McGill University.
<br>
<a href="https://functionalgenomics.ca/" class="fa fa-home"></a>
<a href="https://github.com/fungenomics/" class="fa fa-github"></a>
</p>


<br>