---
title: "02 - Analysis 2"
author: "Selin Jessa"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    theme: flatly
    css: ../include/style.css
    toc: yes
    toc_depth: 4
    number_sections: true
    df_print: paged
    includes:
      before_body: ../include/header.html
      after_body:  ../include/footer.html
---

<!-- FRONT MATTER -->

<!-- Load custom CSS/JS for code folding -->
<link rel="stylesheet" type="text/css" href="../include/hideOutput.css">
<script src="../include/hideOutput.js"></script>

***

# Configuration

Configuration of project directory & analysis outputs:

<details><summary>Show full config</summary>

```{r config, warning = FALSE}

library(here)
source(here("rr_helpers.R"))

# Set up outputs

# ...determines name of the subfolder of `outputs` and `figures`
doc_id     <- "02"

# ...specify where to save outputs
out        <- here("output", doc_id); dir.create(out, recursive = TRUE)
figout     <- here("figures", doc_id, "/")
cache      <- paste0("~/tmp/", basename(here()), "/", doc_id, "/")

```

</details>

The root directory of this project is:

```{r here, echo = FALSE, cache = FALSE}

message(here())

```

Outputs and figures will be saved at these paths, relative to project root:

```{r print_out_paths, echo = FALSE, cache = FALSE}

message(path_from_here(out))
message(path_from_here(figout))

```

```{r setup, include = FALSE}

# Code to print the location of output / figures, relative to the root
# Usage: set "echo_fig = TRUE" or "echo_out = TRUE" in knitr chunk options
# via https://gist.github.com/Thell/5827832
knitr::knit_hooks$set( echo_fig = function(before, options, envir) {
    if ( before ) {
        # Do nothing
    } else sprintf('<br><span style="color:#0d00ff">~[figure @ *%s*]~</span>',
                   paste0(
                       path_from_here(figout),
                       options$label, "...") )
})

knitr::knit_hooks$set( echo_out = function(before, options, envir) {
    if ( before ) {
        # Do nothing
    } else sprintf('<br><span style="color:#0d00ff">~[output @ *%s*]~</span>',
                   paste0(path_from_here(out),
                          "/",
                          options$label) )
})

# Set knitr options
knitr::opts_chunk$set(message = TRUE,
                      warning = FALSE,
                      error = FALSE,
                      cache = TRUE,
                      cache.path = cache,
                      fig.path = figout,
                      fig.keep = "all",
                      dev = c("png", "pdf"),
                      cache.lazy = FALSE)

options(knitr.table.format = "html") 

# Expand the width for more plotting area
knitr::opts_knit$set(width = 1600)

```

<!-- END OF FRONT MATTER -->

***

# Overview

This is an example of the second analysis in a project, which loads some
outputs produced by the first.

# Libraries

```{r libs, warning = FALSE, message = FALSE, echo = TRUE, cache = FALSE}

library(ggplot2)
library(tidyverse)

```


# Data dependencies

This chunk is wrapped in `<div class="fold o"></div>` to produce a toggle button:

<div class="fold o">
```{r load_data}

mtcars2 <- rr_read_tsv(here("output", "01", "mtcars.tsv"))

```
</div>


# Analysis

We can use the `rr_ggplot` wrapper to save source data alongside the resulting
ggplot, as long as we specify the number of the plot in the chunk.

```{r figure2, echo_fig = TRUE}

mtcars2 %>% 
    rr_ggplot(1, aes(x = disp, y = wt)) +
    geom_line() +
    theme_bw()

mtcars2 %>% 
    rr_ggplot(2, aes(x = disp, y = wt)) +
    geom_point() +
    theme_bw()

```

***

# Reproducibility


This document was last rendered on:

```{r time, echo = FALSE, cache = FALSE}

message(Sys.time())

```

The git repository and last commit:

```{r repo, echo = FALSE, cache = FALSE}

git2r::repository()

```

Session info:
<details>

```{r sinfo, cache = FALSE, echo = FALSE}

if ("devtools" %in% installed.packages()) {
    devtools::session_info()
} else sessionInfo()

```

</details>

***